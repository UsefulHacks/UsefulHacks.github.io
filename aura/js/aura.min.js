"use strict";let mediaElement,audioInputSelect,audioOutputSelect,videoSelect,selectors;function gotDevices(t){const o=selectors.map(e=>e.value);selectors.forEach(e=>{for(;e.firstChild;)e.removeChild(e.firstChild)});for(let e=0;e!==t.length;++e){var n=t[e];const i=document.createElement("option");i.value=n.deviceId,audioInputSelect&&"audioinput"===n.kind?(i.text=n.label||`microphone ${audioInputSelect.length+1}`,audioInputSelect.appendChild(i)):audioOutputSelect&&"audiooutput"===n.kind?(i.text=n.label||`speaker ${audioOutputSelect.length+1}`,audioOutputSelect.appendChild(i)):videoSelect&&"videoinput"===n.kind&&(i.text=n.label||`camera ${videoSelect.length+1}`,videoSelect.appendChild(i))}selectors.forEach((e,t)=>{Array.prototype.slice.call(e.childNodes).some(e=>e.value===o[t])&&(e.value=o[t])})}function attachSinkId(e,t){void 0!==e.sinkId?e.setSinkId(t).then(()=>{console.log(`Success, audio output device attached: ${t}`)}).catch(e=>{let t=e;"SecurityError"===e.name&&(t=`You need to use HTTPS for selecting audio output device: ${e}`),console.error(t),audioOutputSelect.selectedIndex=0}):console.warn("Browser does not support output device selection.")}function changeAudioDestination(){var e=audioOutputSelect.value;attachSinkId(mediaElement,e)}function gotStream(e){return mediaElement.srcObject=e,navigator.mediaDevices.enumerateDevices()}function handleError(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}function mediaDevicesStop(){const e=mediaElement.srcObject;if(e){const t=e.getTracks();t.forEach(e=>e.stop())}console.log("mediaDevicesStop()")}function mediaDevicesStart(){mediaDevicesStop();var e=audioInputSelect?audioInputSelect.value:null,t=videoSelect?videoSelect.value:null;navigator.mediaDevices.getUserMedia({audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:t?{exact:t}:void 0}}).then(gotStream).then(gotDevices).catch(handleError),console.log("mediaDevicesStart()")}const mediaDevicesInit=e=>{mediaElement=e.mediaElement,audioInputSelect=e.audioInputSelect,audioOutputSelect=e.audioOutputSelect,videoSelect=e.videoSelect,selectors=[],[audioInputSelect,audioOutputSelect,videoSelect].forEach(e=>{e&&selectors.push(e)}),audioInputSelect&&(audioInputSelect.onchange=mediaDevicesStart),audioOutputSelect&&(audioOutputSelect.disabled=!("sinkId"in HTMLMediaElement.prototype)),audioOutputSelect&&(audioOutputSelect.onchange=changeAudioDestination),videoSelect&&(videoSelect.onchange=mediaDevicesStart),navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(handleError),console.log("mediaDevicesInit()"),mediaDevicesStart()};mediaDevicesInit({mediaElement:document.querySelector("video"),audioInputSelect:null,audioOutputSelect:null,videoSelect:document.querySelector("select#videoSource")});const msToSmpteString=(e,t=30)=>{var o=e/36e5,n=Math.floor(o),i=60*(o-n),e=Math.floor(i),o=60*(i-e),i=Math.floor(o),t=Math.floor((o-i)*t);return`${n<10?"0":""}${n}:${e<10?"0":""}${e}:${o<10?"0":""}${i};${t<10?"0":""}${t}`},msToSmpteStringhhmmss=(e,t=0)=>{var o=e/36e5,n=Math.floor(o),e=60*(o-n),o=Math.floor(e),e=60*(e-o);return`${n<10?"0":""}${n}:${o<10?"0":""}${o}:${e<10?"0":""}${Math.floor(e)}`},triangles=[{x1:330,y1:140,x2:300,y2:140,x3:285,y3:125},{x1:240,y1:100,x2:240,y2:60,x3:250,y3:90},{x1:280,y1:110,x2:330,y2:140,x3:285,y3:125},{x1:330,y1:140,x2:290,y2:150,x3:300,y3:140},{x1:280,y1:90,x2:320,y2:80,x3:325,y3:90},{x1:280,y1:80,x2:280,y2:50,x3:320,y3:80},{x1:280,y1:90,x2:280,y2:80,x3:320,y3:80},{x1:280,y1:90,x2:325,y2:90,x3:330,y3:110},{x1:230,y1:190,x2:240,y2:170,x3:280,y3:170},{x1:240,y1:60,x2:210,y2:90,x3:240,y3:100},{x1:240,y1:60,x2:210,y2:90,x3:200,y3:70},{x1:280,y1:90,x2:330,y2:110,x3:330,y3:140},{x1:280,y1:90,x2:330,y2:110,x3:320,y3:80},{x1:280,y1:90,x2:330,y2:140,x3:280,y3:110},{x1:330,y1:140,x2:280,y2:110,x3:290,y3:150},{x1:280,y1:110,x2:280,y2:90,x3:250,y3:90},{x1:250,y1:90,x2:280,y2:110,x3:280,y3:90},{x1:290,y1:150,x2:330,y2:140,x3:280,y3:110},{x1:290,y1:150,x2:330,y2:140,x3:320,y3:170},{x1:290,y1:150,x2:320,y2:170,x3:280,y3:170},{x1:290,y1:150,x2:280,y2:170,x3:250,y3:170},{x1:280,y1:170,x2:320,y2:170,x3:270,y3:200},{x1:270,y1:200,x2:280,y2:170,x3:250,y3:200},{x1:250,y1:200,x2:280,y2:170,x3:270,y3:200},{x1:250,y1:200,x2:280,y2:170,x3:230,y3:190},{x1:230,y1:190,x2:280,y2:170,x3:250,y3:200},{x1:230,y1:190,x2:280,y2:170,x3:250,y3:170},{x1:230,y1:190,x2:250,y2:200,x3:210,y3:210},{x1:210,y1:210,x2:250,y2:200,x3:230,y3:190},{x1:210,y1:210,x2:230,y2:190,x3:190,y3:180},{x1:190,y1:180,x2:230,y2:190,x3:210,y3:210},{x1:190,y1:180,x2:230,y2:190,x3:250,y3:170},{x1:190,y1:180,x2:210,y2:210,x3:160,y3:170},{x1:250,y1:170,x2:280,y2:170,x3:290,y3:150},{x1:200,y1:70,x2:210,y2:90,x3:150,y3:70},{x1:200,y1:70,x2:210,y2:90,x3:240,y3:60},{x1:150,y1:70,x2:200,y2:70,x3:210,y3:90},{x2:200,y2:70,x3:220,y3:50,x1:240,y1:60},{x1:240,y1:100,x2:250,y2:90,x3:240,y3:60},{x1:240,y1:60,x2:240,y2:100,x3:210,y3:90},{x1:240,y1:60,x2:240,y2:100,x3:250,y3:90},{x1:240,y1:60,x2:240,y2:100,x3:210,y3:90},{x1:210,y1:90,x2:180,y2:100,x3:150,y3:70},{x1:240,y1:60,x2:200,y2:70,x3:210,y3:90},{x1:240,y1:60,x2:200,y2:70,x3:210,y3:90},{x1:210,y1:90,x2:240,y2:60,x3:240,y3:100},{x1:210,y1:90,x2:240,y2:100,x3:240,y3:60},{x1:250,y1:90,x2:240,y2:60,x3:280,y3:50},{x1:250,y1:90,x2:240,y2:60,x3:280,y3:50},{x1:280,y1:90,x2:320,y2:80,x3:280,y3:50},{x1:280,y1:50,x2:280,y2:90,x3:250,y3:90},{x1:280,y1:50,x2:280,y2:90,x3:250,y3:90},{x1:250,y1:90,x2:280,y2:50,x3:280,y3:90},{x1:280,y1:50,x2:240,y2:60,x3:250,y3:90},{x1:250,y1:90,x2:280,y2:90,x3:280,y3:50}];let glHueOffset=0,glMaterial=null,glRenderId=null;function main(e){var t=document.querySelector("#webGLCanvas");const a=new THREE.WebGLRenderer({canvas:t,alpha:!0});const c=new THREE.PerspectiveCamera(75,2,.1,100);c.position.z=20,c.position.y=0,c.position.x=-3;const r=new THREE.Scene;r.background=null;{const w=new THREE.DirectionalLight(16777215,1);w.position.set(-1,2,4),r.add(w)}const o=[];const n=[];const i=[];var l=function(t,o){let n=[],i=1e6,a=-1e6,c=1e6,l=-1e6;var r=t.length;for(let e=0;e<r;e++){var d=t[e];d.x1>a&&(a=d.x1),d.x2>a&&(a=d.x2),d.x3>a&&(a=d.x3),d.y1>l&&(l=d.y1),d.y2>l&&(l=d.y2),d.y3>l&&(l=d.y3),d.x1<i&&(i=d.x1),d.x2<i&&(i=d.x2),d.x3<i&&(i=d.x3),d.y1<c&&(c=d.y1),d.y2<c&&(c=d.y2),d.y3<c&&(c=d.y3)}var s=(e,t,o)=>(e-.5*(t+o))/(.5*(o-t));for(let e=0;e<r;e++){var y=t[e];n.push(s(y.x1,i,a)*o*2*.5,s(y.y1,c,l)*o,0,s(y.x2,i,a)*o*2*.5,s(y.y2,c,l)*o,0,s(y.x3,i,a)*o*2*.5,s(y.y3,c,l)*o,0)}return n}(triangles,20);let d=0;for(let e=0;e<l.length;e+=3)o.push(l[e],l[e+1],l[e+2]),n.push(0!=e&&!(e%6),0!=e&&!(e%3)||!(e%6)),i.push(d),d++;const s=new THREE.BufferGeometry;s.setAttribute("position",new THREE.BufferAttribute(new Float32Array(o),3)),s.setAttribute("normal",new THREE.BufferAttribute(new Float32Array([]),3)),s.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(n),2)),s.setIndex(i);var y;glMaterial=(y=e,new THREE.ShaderMaterial({uniforms:{hsvOffset:{value:new THREE.Vector3(0,0,0)},texture:{value:y},uvOffset:{value:new THREE.Vector2(0,0)},color1:{value:new THREE.Color("red")},color2:{value:new THREE.Color("green")}},vertexShader:`
        varying vec2 vUv;
    
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
        }
      `,fragmentShader:`
        uniform vec3 hsvOffset;
        uniform vec3 color1;
        uniform vec3 color2;
        // The uv offset uniform we defined in js code
        uniform vec2 uvOffset;
        // The texture uniform we defined in js code
        // uniform sampler2D texture;
          
        varying vec2 vUv;

        vec3 hsv2rgb(float h, float s, float v)
        {
          h = fract(h + hsvOffset[0]);  // Modulate hue component
          vec3 c = smoothstep(2./6., 1./6., abs(h - vec3(0.5, 2./6., 4./6.)));
          c.r = 1.-c.r;
          return mix(vec3(s), vec3(1.0), c) * v;
        }

        void main() {
          gl_FragColor = vec4(hsv2rgb((vUv.x+vUv.y), 0.0, 1.0), 0.750); // full gradient
          // float spectraPortion = 1.0; // visible portion of full gradient
          // gl_FragColor = vec4(hsv2rgb((vUv.x+vUv.y)*spectraPortion, 0.0, 1.0), 0.750);
        }
      `}));const u=function(e,t,o){const n=new THREE.Mesh(e,glMaterial);return r.add(n),n.position.x=t,n.position.y=o,n}(s,0,0),x=function(e){var t=new THREE.CircleGeometry(15,32);const o=document.createElement("canvas"),n=o.getContext("2d"),i=n.createRadialGradient(150,75,10,100,75,80);i.addColorStop(0,"white"),i.addColorStop(1,"black"),n.arc(150,75,150,0,2*Math.PI),n.fillStyle=i,n.fill();const a=new THREE.Texture(o);a.needsUpdate=!0;var c=new THREE.MeshBasicMaterial({alphaMap:a,side:THREE.DoubleSide,opacity:.25,transparent:!0});const l=new THREE.Mesh(t,c);return r.add(l),l.position.x=e+.14,l.position.z=-.01,l}(0);let v;let m=.1;const p=.998,g=5e-4,f=3.5;let h=0;function S(e){h++,void 0===v&&(v=e),glHueOffset+=m,1<glHueOffset&&(glHueOffset=1-glHueOffset),glMaterial.uniforms.hsvOffset.value=[glHueOffset,0,0];var t,o,n,i=h*g;(i=Math.pow(i,3))>f&&(h=0),u.scale.x=u.scale.y=i,x.scale.x=x.scale.y=i,x.material.opacity*=p,t=a,o=t.domElement,n=o.clientWidth,e=o.clientHeight,(o=o.width!==n||o.height!==e)&&t.setSize(n,e,!1),o&&(o=a.domElement,c.aspect=o.clientWidth/o.clientHeight,c.updateProjectionMatrix()),h%30||(document.getElementById("timecodeDiv").textContent=msToSmpteStringhhmmss(i/f*30*6e4)),a.render(r,c),glRenderId=requestAnimationFrame(S)}const E=()=>{const e=document.getElementById("pauseBtn");console.log("pauseBtn BUTTON CLICKED"),"Pause"==e.textContent?null!=glRenderId&&(cancelAnimationFrame(glRenderId),e.textContent="Resume",glRenderId=null):(e.textContent="Pause",glRenderId=requestAnimationFrame(S))},I=document.getElementById("pauseBtn");I.addEventListener("click",e=>{E(),e.preventDefault()}),window.addEventListener("keyup",e=>{var t;e.defaultPrevented||(" "!==(t=e.key||e.keyCode)&&32!=t||(e.preventDefault(),E()))});window.onresize=()=>{a.setSize(window.innerWidth,window.innerHeight)},glRenderId=requestAnimationFrame(S)}let constraints={audio:!1,video:!0};const constraintsBackCamera={audio:!1,video:{facingMode:{exact:"environment"}}};navigator.mediaDevices.getUserMedia(constraints).then(function(e){var t=document.getElementById("videoBg");t.srcObject=e,t.onloadedmetadata=function(e){t.play(),main()}}).catch(function(e){console.log(e.name+": "+e.message)});const toggleVideo=()=>{const t=document.getElementById("videoBg"),o=document.getElementById("videoMuteBtn");console.log("toggleVideo BUTTON CLICKED");const e=t.srcObject,n=e.getTracks();n.forEach(e=>e.stop()),"Close eyes"==o.textContent?o.textContent="Open eyes":navigator.mediaDevices.getUserMedia(constraints).then(function(e){t.srcObject=e,t.onloadedmetadata=function(e){t.play(),o.textContent="Close eyes"}}).catch(function(e){console.log(e.name+": "+e.message)})},eyesBtn=document.getElementById("videoMuteBtn");eyesBtn.addEventListener("click",toggleVideo);export{mediaDevicesStop,mediaDevicesStart,msToSmpteString,msToSmpteStringhhmmss,triangles};