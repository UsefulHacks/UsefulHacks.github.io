"use strict";let mediaElement,audioInputSelect,audioOutputSelect,videoSelect,selectors;function gotDevices(t){const n=selectors.map(e=>e.value);selectors.forEach(e=>{for(;e.firstChild;)e.removeChild(e.firstChild)});for(let e=0;e!==t.length;++e){var o=t[e];const i=document.createElement("option");i.value=o.deviceId,audioInputSelect&&"audioinput"===o.kind?(i.text=o.label||`microphone ${audioInputSelect.length+1}`,audioInputSelect.appendChild(i)):audioOutputSelect&&"audiooutput"===o.kind?(i.text=o.label||`speaker ${audioOutputSelect.length+1}`,audioOutputSelect.appendChild(i)):videoSelect&&"videoinput"===o.kind&&(i.text=o.label||`camera ${videoSelect.length+1}`,videoSelect.appendChild(i))}selectors.forEach((e,t)=>{Array.prototype.slice.call(e.childNodes).some(e=>e.value===n[t])&&(e.value=n[t])})}function attachSinkId(e,t){void 0!==e.sinkId?e.setSinkId(t).then(()=>{console.log(`Success, audio output device attached: ${t}`)}).catch(e=>{let t=e;"SecurityError"===e.name&&(t=`You need to use HTTPS for selecting audio output device: ${e}`),console.error(t),audioOutputSelect.selectedIndex=0}):console.warn("Browser does not support output device selection.")}function changeAudioDestination(){var e=audioOutputSelect.value;attachSinkId(mediaElement,e)}function gotStream(e){return mediaElement.srcObject=e,navigator.mediaDevices.enumerateDevices()}function handleError(e){console.log("navigator.MediaDevices error: ",e.message,e.name)}function mediaDevicesStop(){const e=mediaElement.srcObject;if(e){console.log("mediaDevicesStop()");const t=e.getTracks();t.forEach(e=>e.stop())}else console.warn("mediaDevicesStop(): no tracks to stop")}function mediaDevicesStart(){console.log("mediaDevicesStart()"),mediaDevicesStop();var e=audioInputSelect?audioInputSelect.value:null,t=videoSelect?videoSelect.value:null;return navigator.mediaDevices.getUserMedia({audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:t?{exact:t}:void 0}}).then(gotStream).then(gotDevices)}const mediaDevicesInit=async e=>{console.log("mediaDevicesInit()"),"undefined"==mediaElement&&await navigator.mediaDevices.getUserMedia({audio:!!e.audioInputSelect||!!e.audioOutputSelect,video:!!e.videoSelect}),mediaElement=e.mediaElement,audioInputSelect=e.audioInputSelect,audioOutputSelect=e.audioOutputSelect,videoSelect=e.videoSelect,selectors=[],[audioInputSelect,audioOutputSelect,videoSelect].forEach(e=>{e&&selectors.push(e)}),audioInputSelect&&(audioInputSelect.onchange=mediaDevicesStart),audioOutputSelect&&(audioOutputSelect.disabled=!("sinkId"in HTMLMediaElement.prototype)),audioOutputSelect&&(audioOutputSelect.onchange=changeAudioDestination),videoSelect&&(videoSelect.onchange=mediaDevicesStart),await navigator.mediaDevices.enumerateDevices().then(gotDevices).then(mediaDevicesStart).catch(handleError)};mediaDevicesInit({mediaElement:document.querySelector("video"),audioInputSelect:null,audioOutputSelect:null,videoSelect:document.querySelector("select#videoSource")});const msToSmpteString=(e,t=30)=>{var n=e/36e5,o=Math.floor(n),i=60*(n-o),e=Math.floor(i),n=60*(i-e),i=Math.floor(n),t=Math.floor((n-i)*t);return`${o<10?"0":""}${o}:${e<10?"0":""}${e}:${n<10?"0":""}${i};${t<10?"0":""}${t}`},msToSmpteStringhhmmss=(e,t=0)=>{var n=e/36e5,o=Math.floor(n),e=60*(n-o),n=Math.floor(e),e=60*(e-n);return`${o<10?"0":""}${o}:${n<10?"0":""}${n}:${e<10?"0":""}${Math.floor(e)}`},triangles=[{x1:330,y1:140,x2:300,y2:140,x3:285,y3:125},{x1:240,y1:100,x2:240,y2:60,x3:250,y3:90},{x1:280,y1:110,x2:330,y2:140,x3:285,y3:125},{x1:330,y1:140,x2:290,y2:150,x3:300,y3:140},{x1:280,y1:90,x2:320,y2:80,x3:325,y3:90},{x1:280,y1:80,x2:280,y2:50,x3:320,y3:80},{x1:280,y1:90,x2:280,y2:80,x3:320,y3:80},{x1:280,y1:90,x2:325,y2:90,x3:330,y3:110},{x1:230,y1:190,x2:240,y2:170,x3:280,y3:170},{x1:240,y1:60,x2:210,y2:90,x3:240,y3:100},{x1:240,y1:60,x2:210,y2:90,x3:200,y3:70},{x1:280,y1:90,x2:330,y2:110,x3:330,y3:140},{x1:280,y1:90,x2:330,y2:110,x3:320,y3:80},{x1:280,y1:90,x2:330,y2:140,x3:280,y3:110},{x1:330,y1:140,x2:280,y2:110,x3:290,y3:150},{x1:280,y1:110,x2:280,y2:90,x3:250,y3:90},{x1:250,y1:90,x2:280,y2:110,x3:280,y3:90},{x1:290,y1:150,x2:330,y2:140,x3:280,y3:110},{x1:290,y1:150,x2:330,y2:140,x3:320,y3:170},{x1:290,y1:150,x2:320,y2:170,x3:280,y3:170},{x1:290,y1:150,x2:280,y2:170,x3:250,y3:170},{x1:280,y1:170,x2:320,y2:170,x3:270,y3:200},{x1:270,y1:200,x2:280,y2:170,x3:250,y3:200},{x1:250,y1:200,x2:280,y2:170,x3:270,y3:200},{x1:250,y1:200,x2:280,y2:170,x3:230,y3:190},{x1:230,y1:190,x2:280,y2:170,x3:250,y3:200},{x1:230,y1:190,x2:280,y2:170,x3:250,y3:170},{x1:230,y1:190,x2:250,y2:200,x3:210,y3:210},{x1:210,y1:210,x2:250,y2:200,x3:230,y3:190},{x1:210,y1:210,x2:230,y2:190,x3:190,y3:180},{x1:190,y1:180,x2:230,y2:190,x3:210,y3:210},{x1:190,y1:180,x2:230,y2:190,x3:250,y3:170},{x1:190,y1:180,x2:210,y2:210,x3:160,y3:170},{x1:250,y1:170,x2:280,y2:170,x3:290,y3:150},{x1:200,y1:70,x2:210,y2:90,x3:150,y3:70},{x1:200,y1:70,x2:210,y2:90,x3:240,y3:60},{x1:150,y1:70,x2:200,y2:70,x3:210,y3:90},{x2:200,y2:70,x3:220,y3:50,x1:240,y1:60},{x1:240,y1:100,x2:250,y2:90,x3:240,y3:60},{x1:240,y1:60,x2:240,y2:100,x3:210,y3:90},{x1:240,y1:60,x2:240,y2:100,x3:250,y3:90},{x1:240,y1:60,x2:240,y2:100,x3:210,y3:90},{x1:210,y1:90,x2:180,y2:100,x3:150,y3:70},{x1:240,y1:60,x2:200,y2:70,x3:210,y3:90},{x1:240,y1:60,x2:200,y2:70,x3:210,y3:90},{x1:210,y1:90,x2:240,y2:60,x3:240,y3:100},{x1:210,y1:90,x2:240,y2:100,x3:240,y3:60},{x1:250,y1:90,x2:240,y2:60,x3:280,y3:50},{x1:250,y1:90,x2:240,y2:60,x3:280,y3:50},{x1:280,y1:90,x2:320,y2:80,x3:280,y3:50},{x1:280,y1:50,x2:280,y2:90,x3:250,y3:90},{x1:280,y1:50,x2:280,y2:90,x3:250,y3:90},{x1:250,y1:90,x2:280,y2:50,x3:280,y3:90},{x1:280,y1:50,x2:240,y2:60,x3:250,y3:90},{x1:250,y1:90,x2:280,y2:90,x3:280,y3:50}];let glHueOffset=0,glMaterial=null,glRenderId=null;function main(e=null){var t=document.querySelector("#webGLCanvas");const l=new THREE.WebGLRenderer({canvas:t,alpha:!0});const a=new THREE.PerspectiveCamera(75,2,.1,100);a.position.z=20,a.position.y=0,a.position.x=-3;const r=new THREE.Scene;r.background=null;{const I=new THREE.DirectionalLight(16777215,1);I.position.set(-1,2,4),r.add(I)}const n=[];const o=[];const i=[];var c=function(t,n){let o=[],i=1e6,l=-1e6,a=1e6,c=-1e6;var r=t.length;for(let e=0;e<r;e++){var u=t[e];u.x1>l&&(l=u.x1),u.x2>l&&(l=u.x2),u.x3>l&&(l=u.x3),u.y1>c&&(c=u.y1),u.y2>c&&(c=u.y2),u.y3>c&&(c=u.y3),u.x1<i&&(i=u.x1),u.x2<i&&(i=u.x2),u.x3<i&&(i=u.x3),u.y1<a&&(a=u.y1),u.y2<a&&(a=u.y2),u.y3<a&&(a=u.y3)}var s=(e,t,n)=>(e-.5*(t+n))/(.5*(n-t));for(let e=0;e<r;e++){var d=t[e];o.push(s(d.x1,i,l)*n*2*.5,s(d.y1,a,c)*n,0,s(d.x2,i,l)*n*2*.5,s(d.y2,a,c)*n,0,s(d.x3,i,l)*n*2*.5,s(d.y3,a,c)*n,0)}return o}(triangles,20);let u=0;for(let e=0;e<c.length;e+=3)n.push(c[e],c[e+1],c[e+2]),o.push(0!=e&&!(e%6),0!=e&&!(e%3)||!(e%6)),i.push(u),u++;const s=new THREE.BufferGeometry;s.setAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),s.setAttribute("normal",new THREE.BufferAttribute(new Float32Array([]),3)),s.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(o),2)),s.setIndex(i);var d;glMaterial=(d=e,new THREE.ShaderMaterial({uniforms:{hsvOffset:{value:new THREE.Vector3(0,0,0)},texture:{value:d},uvOffset:{value:new THREE.Vector2(0,0)},color1:{value:new THREE.Color("red")},color2:{value:new THREE.Color("green")}},vertexShader:`
        varying vec2 vUv;
    
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
        }
      `,fragmentShader:`
      uniform vec3 hsvOffset;
      varying vec2 vUv;
        vec3 hue2rgb(float h) {
          vec3 c = vec3(h, 0.0, 0.0);
          float k = 0.1; 
          return smoothstep(0. + k, 1. - k,1. * (
                            .5 + .5 * cos((vec3(c.x) + vec3(1., 2./3., 1./3.)) * radians(360.))));
      }
      void main() {
        gl_FragColor = vec4(hue2rgb(fract(vUv.x + vUv.y + hsvOffset[0])), 0.80);
      }
      `}));const y=function(e,t,n){const o=new THREE.Mesh(e,glMaterial);return r.add(o),o.position.x=t,o.position.y=n,o}(s,0,0),x=function(e){var t=new THREE.CircleGeometry(15,32);const n=document.createElement("canvas"),o=n.getContext("2d"),i=o.createRadialGradient(150,75,10,100,75,80);i.addColorStop(0,"white"),i.addColorStop(1,"black"),o.arc(150,75,150,0,2*Math.PI),o.fillStyle=i,o.fill();const l=new THREE.Texture(n);l.needsUpdate=!0;var a=new THREE.MeshBasicMaterial({alphaMap:l,side:THREE.DoubleSide,opacity:.25,transparent:!0});const c=new THREE.Mesh(t,a);return r.add(c),c.position.x=e+.14,c.position.z=-.01,c}(0);let m;let v=.1;const p=.998,g=5e-4,S=3.5;let f=0;function h(e){f++,void 0===m&&(m=e),glHueOffset+=v,1<glHueOffset&&(glHueOffset=1-glHueOffset),glMaterial.uniforms.hsvOffset.value=[glHueOffset,0,0];var t,n,o,i=f*g;(i=Math.pow(i,3))>S&&(f=0),y.scale.x=y.scale.y=i,x.scale.x=x.scale.y=i,x.material.opacity*=p,t=l,n=t.domElement,o=n.clientWidth,e=n.clientHeight,(n=n.width!==o||n.height!==e)&&t.setSize(o,e,!1),n&&(n=l.domElement,a.aspect=n.clientWidth/n.clientHeight,a.updateProjectionMatrix()),f%30||(document.getElementById("timecodeDiv").textContent=msToSmpteStringhhmmss(i/S*30*6e4)),l.render(r,a),glRenderId=requestAnimationFrame(h)}const E=()=>{const e=document.getElementById("pauseBtn");"Pause"==e.textContent?null!=glRenderId&&(cancelAnimationFrame(glRenderId),e.textContent="Resume",glRenderId=null):(e.textContent="Pause",glRenderId=requestAnimationFrame(h))},w=document.getElementById("pauseBtn");w.addEventListener("click",e=>{E(),e.preventDefault()}),window.addEventListener("keyup",e=>{var t;e.defaultPrevented||(" "!==(t=e.key||e.keyCode)&&32!=t||(e.preventDefault(),E()))});window.onresize=()=>{l.setSize(window.innerWidth,window.innerHeight)},glRenderId=requestAnimationFrame(h)}let constraints={audio:!1,video:!0};const constraintsBackCamera={audio:!1,video:{facingMode:{exact:"environment"}}},toggleVideo=()=>{document.getElementById("videoBg");const e=document.getElementById("videoMuteBtn");"Close eyes"==e.textContent?(mediaDevicesStop(),e.textContent="Open eyes"):(mediaDevicesStart(),e.textContent="Close eyes")},eyesBtn=document.getElementById("videoMuteBtn");eyesBtn.addEventListener("click",toggleVideo);async function openFullscreen(){const e=document.documentElement;return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():void 0}async function closeFullscreen(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}const toggleFullScreen=()=>{document.fullscreenElement||document.webkitCurrentFullScreenElement?(console.log("Exiting full-screen mode"),closeFullscreen().catch(e=>{console.log(`Error attempting to exit full-screen mode: ${e.message} (${e.name})`)})):openFullscreen().catch(e=>{console.log(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})},fullscreenBtn=document.getElementById("fullscreenBtn");fullscreenBtn.addEventListener("click",toggleFullScreen),main();export{mediaDevicesStop,mediaDevicesStart,msToSmpteString,msToSmpteStringhhmmss,triangles};