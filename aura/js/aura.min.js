"use strict";let mediaElement,audioInputSelect,audioOutputSelect,videoSelect,selectors;function gotDevices(t){const n=selectors.map(e=>e.value);selectors.forEach(e=>{for(;e.firstChild;)e.removeChild(e.firstChild)});for(let e=0;e!==t.length;++e){var o=t[e];const i=document.createElement("option");i.value=o.deviceId,audioInputSelect&&"audioinput"===o.kind?(i.text=o.label||`microphone ${audioInputSelect.length+1}`,audioInputSelect.appendChild(i)):audioOutputSelect&&"audiooutput"===o.kind?(i.text=o.label||`speaker ${audioOutputSelect.length+1}`,audioOutputSelect.appendChild(i)):videoSelect&&"videoinput"===o.kind&&(i.text=o.label||`camera ${videoSelect.length+1}`,videoSelect.appendChild(i))}selectors.forEach((e,t)=>{Array.prototype.slice.call(e.childNodes).some(e=>e.value===n[t])&&(e.value=n[t])})}function attachSinkId(e,t){void 0!==e.sinkId?e.setSinkId(t).then(()=>{console.log(`Success, audio output device attached: ${t}`)}).catch(e=>{let t=e;"SecurityError"===e.name&&(t=`You need to use HTTPS for selecting audio output device: ${e}`),console.error(t),audioOutputSelect.selectedIndex=0}):console.warn("Browser does not support output device selection.")}function changeAudioDestination(){var e=audioOutputSelect.value;attachSinkId(mediaElement,e)}function gotStream(e){return mediaElement.srcObject=e,navigator.mediaDevices.enumerateDevices()}function handleError(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}function mediaDevicesStop(){const e=mediaElement.srcObject;if(e){const t=e.getTracks();t.forEach(e=>e.stop())}console.log("mediaDevicesStop()")}function mediaDevicesStart(){mediaDevicesStop();var e=audioInputSelect?audioInputSelect.value:null,t=videoSelect?videoSelect.value:null;navigator.mediaDevices.getUserMedia({audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:t?{exact:t}:void 0}}).then(gotStream).then(gotDevices).catch(handleError),console.log("mediaDevicesStart()")}const mediaDevicesInit=e=>{mediaElement=e.mediaElement,audioInputSelect=e.audioInputSelect,audioOutputSelect=e.audioOutputSelect,videoSelect=e.videoSelect,selectors=[],[audioInputSelect,audioOutputSelect,videoSelect].forEach(e=>{e&&selectors.push(e)}),audioInputSelect&&(audioInputSelect.onchange=mediaDevicesStart),audioOutputSelect&&(audioOutputSelect.disabled=!("sinkId"in HTMLMediaElement.prototype)),audioOutputSelect&&(audioOutputSelect.onchange=changeAudioDestination),videoSelect&&(videoSelect.onchange=mediaDevicesStart),navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(handleError),console.log("mediaDevicesInit()"),mediaDevicesStart()};mediaDevicesInit({mediaElement:document.querySelector("video"),audioInputSelect:null,audioOutputSelect:null,videoSelect:document.querySelector("select#videoSource")});const msToSmpteString=(e,t=30)=>{var n=e/36e5,o=Math.floor(n),i=60*(n-o),e=Math.floor(i),n=60*(i-e),i=Math.floor(n),t=Math.floor((n-i)*t);return`${o<10?"0":""}${o}:${e<10?"0":""}${e}:${n<10?"0":""}${i};${t<10?"0":""}${t}`},msToSmpteStringhhmmss=(e,t=0)=>{var n=e/36e5,o=Math.floor(n),e=60*(n-o),n=Math.floor(e),e=60*(e-n);return`${o<10?"0":""}${o}:${n<10?"0":""}${n}:${e<10?"0":""}${Math.floor(e)}`},triangles=[{x1:330,y1:140,x2:300,y2:140,x3:285,y3:125},{x1:240,y1:100,x2:240,y2:60,x3:250,y3:90},{x1:280,y1:110,x2:330,y2:140,x3:285,y3:125},{x1:330,y1:140,x2:290,y2:150,x3:300,y3:140},{x1:280,y1:90,x2:320,y2:80,x3:325,y3:90},{x1:280,y1:80,x2:280,y2:50,x3:320,y3:80},{x1:280,y1:90,x2:280,y2:80,x3:320,y3:80},{x1:280,y1:90,x2:325,y2:90,x3:330,y3:110},{x1:230,y1:190,x2:240,y2:170,x3:280,y3:170},{x1:240,y1:60,x2:210,y2:90,x3:240,y3:100},{x1:240,y1:60,x2:210,y2:90,x3:200,y3:70},{x1:280,y1:90,x2:330,y2:110,x3:330,y3:140},{x1:280,y1:90,x2:330,y2:110,x3:320,y3:80},{x1:280,y1:90,x2:330,y2:140,x3:280,y3:110},{x1:330,y1:140,x2:280,y2:110,x3:290,y3:150},{x1:280,y1:110,x2:280,y2:90,x3:250,y3:90},{x1:250,y1:90,x2:280,y2:110,x3:280,y3:90},{x1:290,y1:150,x2:330,y2:140,x3:280,y3:110},{x1:290,y1:150,x2:330,y2:140,x3:320,y3:170},{x1:290,y1:150,x2:320,y2:170,x3:280,y3:170},{x1:290,y1:150,x2:280,y2:170,x3:250,y3:170},{x1:280,y1:170,x2:320,y2:170,x3:270,y3:200},{x1:270,y1:200,x2:280,y2:170,x3:250,y3:200},{x1:250,y1:200,x2:280,y2:170,x3:270,y3:200},{x1:250,y1:200,x2:280,y2:170,x3:230,y3:190},{x1:230,y1:190,x2:280,y2:170,x3:250,y3:200},{x1:230,y1:190,x2:280,y2:170,x3:250,y3:170},{x1:230,y1:190,x2:250,y2:200,x3:210,y3:210},{x1:210,y1:210,x2:250,y2:200,x3:230,y3:190},{x1:210,y1:210,x2:230,y2:190,x3:190,y3:180},{x1:190,y1:180,x2:230,y2:190,x3:210,y3:210},{x1:190,y1:180,x2:230,y2:190,x3:250,y3:170},{x1:190,y1:180,x2:210,y2:210,x3:160,y3:170},{x1:250,y1:170,x2:280,y2:170,x3:290,y3:150},{x1:200,y1:70,x2:210,y2:90,x3:150,y3:70},{x1:200,y1:70,x2:210,y2:90,x3:240,y3:60},{x1:150,y1:70,x2:200,y2:70,x3:210,y3:90},{x2:200,y2:70,x3:220,y3:50,x1:240,y1:60},{x1:240,y1:100,x2:250,y2:90,x3:240,y3:60},{x1:240,y1:60,x2:240,y2:100,x3:210,y3:90},{x1:240,y1:60,x2:240,y2:100,x3:250,y3:90},{x1:240,y1:60,x2:240,y2:100,x3:210,y3:90},{x1:210,y1:90,x2:180,y2:100,x3:150,y3:70},{x1:240,y1:60,x2:200,y2:70,x3:210,y3:90},{x1:240,y1:60,x2:200,y2:70,x3:210,y3:90},{x1:210,y1:90,x2:240,y2:60,x3:240,y3:100},{x1:210,y1:90,x2:240,y2:100,x3:240,y3:60},{x1:250,y1:90,x2:240,y2:60,x3:280,y3:50},{x1:250,y1:90,x2:240,y2:60,x3:280,y3:50},{x1:280,y1:90,x2:320,y2:80,x3:280,y3:50},{x1:280,y1:50,x2:280,y2:90,x3:250,y3:90},{x1:280,y1:50,x2:280,y2:90,x3:250,y3:90},{x1:250,y1:90,x2:280,y2:50,x3:280,y3:90},{x1:280,y1:50,x2:240,y2:60,x3:250,y3:90},{x1:250,y1:90,x2:280,y2:90,x3:280,y3:50}];let glHueOffset=0,glMaterial=null,glRenderId=null;function main(e=null){var t=document.querySelector("#webGLCanvas");const a=new THREE.WebGLRenderer({canvas:t,alpha:!0});const l=new THREE.PerspectiveCamera(75,2,.1,100);l.position.z=20,l.position.y=0,l.position.x=-3;const r=new THREE.Scene;r.background=null;{const w=new THREE.DirectionalLight(16777215,1);w.position.set(-1,2,4),r.add(w)}const n=[];const o=[];const i=[];var c=function(t,n){let o=[],i=1e6,a=-1e6,l=1e6,c=-1e6;var r=t.length;for(let e=0;e<r;e++){var d=t[e];d.x1>a&&(a=d.x1),d.x2>a&&(a=d.x2),d.x3>a&&(a=d.x3),d.y1>c&&(c=d.y1),d.y2>c&&(c=d.y2),d.y3>c&&(c=d.y3),d.x1<i&&(i=d.x1),d.x2<i&&(i=d.x2),d.x3<i&&(i=d.x3),d.y1<l&&(l=d.y1),d.y2<l&&(l=d.y2),d.y3<l&&(l=d.y3)}var y=(e,t,n)=>(e-.5*(t+n))/(.5*(n-t));for(let e=0;e<r;e++){var u=t[e];o.push(y(u.x1,i,a)*n*2*.5,y(u.y1,l,c)*n,0,y(u.x2,i,a)*n*2*.5,y(u.y2,l,c)*n,0,y(u.x3,i,a)*n*2*.5,y(u.y3,l,c)*n,0)}return o}(triangles,20);let d=0;for(let e=0;e<c.length;e+=3)n.push(c[e],c[e+1],c[e+2]),o.push(0!=e&&!(e%6),0!=e&&!(e%3)||!(e%6)),i.push(d),d++;const y=new THREE.BufferGeometry;y.setAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),y.setAttribute("normal",new THREE.BufferAttribute(new Float32Array([]),3)),y.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(o),2)),y.setIndex(i);var u;glMaterial=(u=e,new THREE.ShaderMaterial({uniforms:{hsvOffset:{value:new THREE.Vector3(0,0,0)},texture:{value:u},uvOffset:{value:new THREE.Vector2(0,0)},color1:{value:new THREE.Color("red")},color2:{value:new THREE.Color("green")}},vertexShader:`
        varying vec2 vUv;
    
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
        }
      `,fragmentShader:`
      uniform vec3 hsvOffset;
      varying vec2 vUv;

      vec3 hue2rgb (float h) {
        #define PI 3.14159265359
        return (1.0 + 0.5 * (cos (2.0 * PI * (h + vec3 (0.0, 2.0 / 3.0, 1.0 / 3.0))) - 1.0));
        }
      void main() {
        gl_FragColor = vec4(hue2rgb(fract(vUv.x + vUv.y + hsvOffset[0])), 0.80);
      }
    `}));const s=function(e,t,n){const o=new THREE.Mesh(e,glMaterial);return r.add(o),o.position.x=t,o.position.y=n,o}(y,0,0),x=function(e){var t=new THREE.CircleGeometry(15,32);const n=document.createElement("canvas"),o=n.getContext("2d"),i=o.createRadialGradient(150,75,10,100,75,80);i.addColorStop(0,"white"),i.addColorStop(1,"black"),o.arc(150,75,150,0,2*Math.PI),o.fillStyle=i,o.fill();const a=new THREE.Texture(n);a.needsUpdate=!0;var l=new THREE.MeshBasicMaterial({alphaMap:a,side:THREE.DoubleSide,opacity:.25,transparent:!0});const c=new THREE.Mesh(t,l);return r.add(c),c.position.x=e+.14,c.position.z=-.01,c}(0);let v;let m=.1;const p=.998,g=5e-4,h=3.5;let S=0;function f(e){S++,void 0===v&&(v=e),glHueOffset+=m,1<glHueOffset&&(glHueOffset=1-glHueOffset),glMaterial.uniforms.hsvOffset.value=[glHueOffset,0,0];var t,n,o,i=S*g;(i=Math.pow(i,3))>h&&(S=0),s.scale.x=s.scale.y=i,x.scale.x=x.scale.y=i,x.material.opacity*=p,t=a,n=t.domElement,o=n.clientWidth,e=n.clientHeight,(n=n.width!==o||n.height!==e)&&t.setSize(o,e,!1),n&&(n=a.domElement,l.aspect=n.clientWidth/n.clientHeight,l.updateProjectionMatrix()),S%30||(document.getElementById("timecodeDiv").textContent=msToSmpteStringhhmmss(i/h*30*6e4)),a.render(r,l),glRenderId=requestAnimationFrame(f)}const E=()=>{const e=document.getElementById("pauseBtn");"Pause"==e.textContent?null!=glRenderId&&(cancelAnimationFrame(glRenderId),e.textContent="Resume",glRenderId=null):(e.textContent="Pause",glRenderId=requestAnimationFrame(f))},I=document.getElementById("pauseBtn");I.addEventListener("click",e=>{E(),e.preventDefault()}),window.addEventListener("keyup",e=>{var t;e.defaultPrevented||(" "!==(t=e.key||e.keyCode)&&32!=t||(e.preventDefault(),E()))});window.onresize=()=>{a.setSize(window.innerWidth,window.innerHeight)},glRenderId=requestAnimationFrame(f)}let constraints={audio:!1,video:!0};const constraintsBackCamera={audio:!1,video:{facingMode:{exact:"environment"}}},toggleVideo=()=>{document.getElementById("videoBg");const e=document.getElementById("videoMuteBtn");"Close eyes"==e.textContent?(mediaDevicesStop(),e.textContent="Open eyes"):(mediaDevicesStart(),e.textContent="Close eyes")},eyesBtn=document.getElementById("videoMuteBtn");function toggleFullScreen(){document.fullscreenElement?(console.log("Exiting full-screen mode"),document.exitFullscreen().catch(e=>{console.log(`Error attempting to exit full-screen mode: ${e.message} (${e.name})`)})):document.querySelector("body").requestFullscreen().catch(e=>{console.log(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})}eyesBtn.addEventListener("click",toggleVideo);const fullscreenBtn=document.getElementById("fullscreenBtn");fullscreenBtn.addEventListener("click",toggleFullScreen),main();export{mediaDevicesStop,mediaDevicesStart,msToSmpteString,msToSmpteStringhhmmss,triangles};